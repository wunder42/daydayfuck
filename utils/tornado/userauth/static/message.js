// Generated by CoffeeScript 1.6.3
(function() {
  var $, updater;

  $ = jQuery;

  updater = {
    socket: null,
    start: function() {
      var url;
      url = 'ws://' + location.host + '/message';
      updater.socket = new WebSocket(url);
      return updater.socket.onmessage = function(e) {
        console.log(e);
        return updater.showMessage(JSON.parse(e.data));
      };
    },
    showMessage: function(msg) {
      var _from, _h;
      console.log(msg);
      if (msg.type === 1) {
        console.log('1');
        return $(".online-num").text(parseInt($(".online-num").text()) + msg.addNum);
      } else if (msg.type === 2) {
        console.log('2');
        return $(".sysinfo").text(msg.msg);
      } else if (msg.type === 3) {
        console.log('3');
        _from = msg.from === $(".username").text() ? 'me' : msg.from;
        _h = "<div class='alert-box info'>" + msg.content + "-->" + _from + "</div>";
        return $(".msghub").prepend(_h);
      }
    }
  };

  $(function() {
    console.log('message in...');
    $("#send").click(function(e) {
      return updater.socket.send(JSON.stringify({
        type: 1
      }));
    });
    updater.start();
    $(".close").click(function(e) {
      e.preventDefault();
      return $(this).parent("div").hide("slow");
    });
    return $(".tozoom").click(function(e) {
      var _t;
      console.log('send');
      _t = $(".cc").val();
      if (!_t) {
        alert('send error');
        $(".cc").value("");
        return;
      }
      return updater.socket.send(JSON.stringify({
        content: _t,
        'userid': $.cookie("userid")
      }));
    });
  });

}).call(this);
